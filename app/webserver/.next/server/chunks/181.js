"use strict";exports.id=181,exports.ids=[181],exports.modules={29787:(e,t,r)=>{r.d(t,{G:()=>p,cX:()=>b,dU:()=>f,qt:()=>g,sw:()=>u,zs:()=>l});var i=r(10841);r(10935);var n=r(30194),a=r(44627),d=r(16151),s=r(32322),o=r(52943);let c=d.z.object({title:d.z.string().min(1,"레시피 이름은 필수입니다"),brewingMethod:d.z.string().min(1,"추출 방식은 필수입니다"),difficulty:d.z.string().optional(),preparationTime:d.z.string().min(1,"소요 시간은 필수입니다"),beanAmount:d.z.string().min(1,"원두량은 필수입니다"),waterAmount:d.z.string().min(1,"물 용량은 필수입니다"),waterTemp:d.z.string().optional(),grindSize:d.z.string().min(1,"분쇄도는 필수입니다"),tools:d.z.string().optional(),acidity:d.z.string().optional(),sweetness:d.z.string().optional(),body:d.z.string().optional(),recommendedBeans:d.z.string().optional(),description:d.z.string().optional(),notes:d.z.string().optional(),steps:d.z.string().optional(),isPublic:d.z.boolean().default(!0),beanId:d.z.string().optional().nullable(),grinderId:d.z.string().optional().nullable(),grinderSetting:d.z.string().optional().nullable()});async function l(e,t,r){let i=await (0,s.A)();if(!i)return{errors:{_form:["로그인이 필요합니다."]}};let d=c.safeParse({title:r.get("title"),description:r.get("description"),brewingMethod:r.get("method"),difficulty:r.get("difficulty"),preparationTime:r.get("preparationTime"),beanAmount:r.get("beanAmount"),waterAmount:r.get("waterAmount"),waterTemp:r.get("waterTemp")||r.get("temperature"),grindSize:r.get("grindSize"),tools:r.get("equipment"),acidity:r.get("acidity")||"중간",sweetness:r.get("sweetness")||"중간",body:r.get("body")||"중간",recommendedBeans:r.get("recommendedBeans")||"",isPublic:"true"===r.get("isPublic"),beanId:r.get("beanId")||null,grinderId:r.get("grinderId")||null,grinderSetting:r.get("grinderSetting")||null});if(!d.success)return{errors:d.error.flatten().fieldErrors,message:"입력 정보를 확인해주세요."};let{title:o,description:l,brewingMethod:g,difficulty:f,preparationTime:u,beanAmount:b,waterAmount:p,waterTemp:m,grindSize:w,tools:z,acidity:h,sweetness:y,body:A,recommendedBeans:I,isPublic:T,beanId:S,grinderId:P,grinderSetting:R}=d.data;try{let e=parseInt(r.get("stepsCount")?.toString()||"0",10),t=[];if(e>0){for(let i=0;i<e;i++){let e=r.get(`step-${i}`)?.toString();e?.trim()&&t.push(e)}t.join("\n")}let d=await a.zR.recipe.create({data:{title:o,description:l,brewingMethod:g,difficulty:f,preparationTime:u,beanAmount:b,waterAmount:p,waterTemp:m,grindSize:w,tools:z,acidity:h,sweetness:y,body:A,recommendedBeans:I,steps:{create:t.map((e,t)=>({order:t+1,description:e}))},isPublic:T,userId:i,grinderId:P,grinderSetting:R,beanId:S||void 0}}),s=r.get("ingredients");if(s)for(let e of s.split(",").map(e=>e.trim()))await a.zR.ingredient.create({data:{name:e,recipeId:d.id}});let c=r.get("brewingTips");if(c)for(let e of c.split("\n").filter(e=>""!==e.trim()))await a.zR.brewingTip.create({data:{content:e.trim(),recipeId:d.id}});return(0,n.revalidatePath)("/recipes"),{message:"레시피가 성공적으로 생성되었습니다."}}catch(e){return console.error("레시피 생성 오류:",e),{errors:{_form:["레시피 생성 중 오류가 발생했습니다. 다시 시도해주세요."]}}}}async function g(e){try{let t={isPublic:!0};return e&&(t={...t,brewingMethod:e}),await a.zR.recipe.findMany({where:t,select:{id:!0,title:!0,description:!0,preparationTime:!0,beanAmount:!0,waterAmount:!0,difficulty:!0,grindSize:!0,brewingMethod:!0,isPublic:!0,createdAt:!0,updatedAt:!0},orderBy:{createdAt:"desc"}})}catch(e){if(console.error("레시피 조회 오류:",e),e instanceof Error&&(e.message.includes("P5010")||e.message.includes("fetch failed")))throw Error("데이터베이스 연결에 실패했습니다. 네트워크 연결을 확인하거나 잠시 후 다시 시도해주세요.");throw Error("레시피를 불러오는 중 오류가 발생했습니다.")}}async function f(e){try{return await a.zR.recipe.findUnique({where:{id:e},include:{ingredients:!0,steps:{orderBy:{order:"asc"}},brewingTips:!0,user:{select:{id:!0,name:!0,image:!0}}}})}catch(e){throw console.error("레시피 상세 조회 오류:",e),Error("레시피를 불러오는 중 오류가 발생했습니다.")}}async function u(e,t,r,i){let d=await (0,s.A)();if(!d)return{errors:{_form:["로그인이 필요합니다."]}};let o=await a.zR.recipe.findUnique({where:{id:e}});if(!o)return{errors:{_form:["존재하지 않는 레시피입니다."]}};if(o.userId!==d)return{errors:{_form:["본인이 작성한 레시피만 수정할 수 있습니다."]}};let l=c.safeParse({title:i.get("title"),description:i.get("description"),brewingMethod:i.get("method")||i.get("brewingMethod"),difficulty:i.get("difficulty"),preparationTime:i.get("preparationTime"),beanAmount:i.get("beanAmount"),waterAmount:i.get("waterAmount"),waterTemp:i.get("waterTemp")||i.get("temperature"),grindSize:i.get("grindSize"),tools:i.get("equipment")||i.get("tools"),acidity:i.get("acidity")||"중간",sweetness:i.get("sweetness")||"중간",body:i.get("body")||"중간",recommendedBeans:i.get("recommendedBeans")||"",isPublic:"true"===i.get("isPublic"),beanId:i.get("beanId")||null,grinderId:i.get("grinderId")||null,grinderSetting:i.get("grinderSetting")||null});if(!l.success)return{errors:l.error.flatten().fieldErrors,message:"입력 정보를 확인해주세요."};let{title:g,description:f,brewingMethod:u,difficulty:b,preparationTime:p,beanAmount:m,waterAmount:w,waterTemp:z,grindSize:h,tools:y,acidity:A,sweetness:I,body:T,recommendedBeans:S,isPublic:P,beanId:R,grinderId:v,grinderSetting:E}=l.data;try{let t="",r=parseInt(i.get("stepsCount")?.toString()||"0",10);if(r>0){let e=[];for(let t=0;t<r;t++){let r=i.get(`step-${t}`)?.toString();r?.trim()&&e.push(r)}t=e.join("\n")}await a.zR.recipe.update({where:{id:e},data:{title:g,description:f,brewingMethod:u,difficulty:b,preparationTime:p,beanAmount:m,waterAmount:w,waterTemp:z,grindSize:h,tools:y,acidity:A,sweetness:I,body:T,recommendedBeans:S,steps:t,isPublic:P,grinderId:v,grinderSetting:E,beanId:R||void 0}}),await a.zR.ingredient.deleteMany({where:{recipeId:e}});let d=i.get("ingredients");if(d)for(let t of d.split(",").map(e=>e.trim()))await a.zR.ingredient.create({data:{name:t,recipeId:e}});await a.zR.brewingTip.deleteMany({where:{recipeId:e}});let s=i.get("brewingTips");if(s)for(let t of s.split("\n").filter(e=>""!==e.trim()))await a.zR.brewingTip.create({data:{content:t.trim(),recipeId:e}});return(0,n.revalidatePath)("/recipes"),(0,n.revalidatePath)(`/recipes/${e}`),{message:"레시피가 성공적으로 업데이트되었습니다."}}catch(e){return console.error("레시피 업데이트 오류:",e),{errors:{_form:["레시피 업데이트 중 오류가 발생했습니다. 다시 시도해주세요."]}}}}async function b(e,t){try{let t=await (0,s.A)();if(!t)throw Error("로그인이 필요합니다.");let r=await a.zR.recipe.findUnique({where:{id:e}});if(!r)throw Error("존재하지 않는 레시피입니다.");let i=process.env.NEXT_PUBLIC_ADMIN_EMAIL===t;if(r.userId!==t&&!i)throw Error("본인이 작성한 레시피만 삭제할 수 있습니다.");return await a.zR.$transaction([a.zR.ingredient.deleteMany({where:{recipeId:e}}),a.zR.brewingTip.deleteMany({where:{recipeId:e}}),a.zR.recipe.delete({where:{id:e}})]),(0,n.revalidatePath)("/recipes"),{success:!0,message:"레시피가 성공적으로 삭제되었습니다."}}catch(e){return console.error("레시피 삭제 오류:",e),{success:!1,message:"레시피 삭제 중 오류가 발생했습니다."}}}async function p(e){try{return await a.zR.recipe.findMany({where:{userId:e},include:{ingredients:!0,steps:{orderBy:{order:"asc"}},brewingTips:!0},orderBy:{createdAt:"desc"}})}catch(e){return console.error("작성자별 레시피 조회 오류:",e),[]}}(0,o.D)([l,g,f,u,b,p]),(0,i.A)(l,"708d2101345b6641f648d5022e57c057d8d2b59f86",null),(0,i.A)(g,"4063dc433687fb1ab011722b26b8d484a075215405",null),(0,i.A)(f,"40bb057f7efcb39c01b4b2de998e3babc3c4b12557",null),(0,i.A)(u,"78caecb7db732db0fd8ce5a41ac82f47dfb73afe07",null),(0,i.A)(b,"60d74d0be3c3bb8c15ff4a2ac4bd90336ad6b21541",null),(0,i.A)(p,"405333280afb49bd5ebeef282575f6f93f24589c34",null)},32322:(e,t,r)=>{r.d(t,{A:()=>d});var i=r(10841);r(10935);var n=r(65208),a=r(83395);async function d(){let e=(0,n.UL)(),t=(0,a.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{get:t=>e.get(t)?.value}}),{data:{user:r}}=await t.auth.getUser();return r?.id||null}(0,r(52943).D)([d]),(0,i.A)(d,"00395df8f493ec72727eb10563087fdf81a261e68d",null)},40181:(e,t,r)=>{r.r(t),r.d(t,{"00395df8f493ec72727eb10563087fdf81a261e68d":()=>n.A,"405333280afb49bd5ebeef282575f6f93f24589c34":()=>i.G,"4063dc433687fb1ab011722b26b8d484a075215405":()=>i.qt,"40bb057f7efcb39c01b4b2de998e3babc3c4b12557":()=>i.dU,"60d74d0be3c3bb8c15ff4a2ac4bd90336ad6b21541":()=>i.cX,"708d2101345b6641f648d5022e57c057d8d2b59f86":()=>i.zs,"78caecb7db732db0fd8ce5a41ac82f47dfb73afe07":()=>i.sw});var i=r(29787),n=r(32322)}};