(()=>{var e={};e.id=6768,e.ids=[6768],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},44627:(e,r,t)=>{"use strict";t.d(r,{kR:()=>i,zR:()=>o});var s=t(96330);let n=global;n.isConnected||(n.isConnected=!1,n.connectionError=null,n.lastConnectionAttempt=0,n.connectionRetryCount=0);let o=n.prisma??function(){let e=process.env.DATABASE_URL;process.env.DIRECT_URL;let r={log:["error"],errorFormat:"pretty"};return e&&(r.datasources={db:{url:e}}),new s.PrismaClient(r)}();async function a(){try{let e=Date.now();if(n.isConnected)return{connected:!0,error:null};if(n.connectionError&&e-n.lastConnectionAttempt<3e4)return{connected:!1,error:n.connectionError};if(n.connectionRetryCount>=3){let r=e-n.lastConnectionAttempt;if(r<3e4)return{connected:!1,error:`${n.connectionError} (${Math.ceil((3e4-r)/1e3)}초 후 재시도 가능)`};n.connectionRetryCount=0}return n.lastConnectionAttempt=e,n.connectionRetryCount++,await o.user.findFirst({select:{id:!0},take:1}),n.isConnected=!0,n.connectionError=null,n.connectionRetryCount=0,{connected:!0,error:null}}catch(r){console.error("Database connection error:",r);let e="데이터베이스 연결 오류";return r instanceof Error&&(r.message.includes("P5010")||r.message.includes("fetch failed")?e="데이터베이스 서버에 연결할 수 없습니다. 네트워크 연결을 확인하거나 잠시 후 다시 시도해주세요.":r.message.includes("timeout")?e="데이터베이스 연결 시간이 초과되었습니다. 잠시 후 다시 시도해주세요.":r.message.includes("authentication")&&(e="데이터베이스 인증에 실패했습니다. 관리자에게 문의하세요.")),n.isConnected=!1,n.connectionError=e,{connected:!1,error:e}}}async function i(e,r,t){try{let s=await a();if(!s.connected)return t&&t(Error(s.error||"데이터베이스 연결 오류")),r;return await e()}catch(e){return console.error("Database operation error:",e),t&&t(e),r}}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},80408:()=>{},81630:e=>{"use strict";e.exports=require("http")},87032:()=>{},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96330:e=>{"use strict";e.exports=require("@prisma/client")},99044:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>x,serverHooks:()=>m,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>f});var s={};t.r(s),t.d(s,{POST:()=>l});var n=t(48106),o=t(48819),a=t(12050),i=t(4235),c=t(44627),u=t(65208),p=t(83395),d=t(1610);async function l(e){try{let r=await (0,u.UL)(),t=(0,p.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL||"",process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",{cookies:{async get(e){let t=await r.get(e);return t?.value},set(){},remove(){}}}),{data:{user:s}}=await t.auth.getUser();if(!s?.id)return i.NextResponse.json({error:"인증이 필요합니다"},{status:401});let{userId:n,currentPassword:o,newPassword:a}=await e.json();if(s.id!==n)return i.NextResponse.json({error:"권한이 없습니다"},{status:403});let l=await c.zR.user.findUnique({where:{id:n},select:{id:!0,password:!0}});if(!l)return i.NextResponse.json({error:"사용자를 찾을 수 없습니다"},{status:404});if(l.password&&!await d.Ay.compare(o,l.password))return i.NextResponse.json({error:"현재 비밀번호가 일치하지 않습니다"},{status:400});let x=await d.Ay.hash(a,10);await c.zR.user.update({where:{id:n},data:{password:x}});let{error:w}=await t.auth.updateUser({password:a});return w&&console.error("Supabase 비밀번호 업데이트 오류:",w),i.NextResponse.json({message:"비밀번호가 성공적으로 변경되었습니다"})}catch(e){return console.error("비밀번호 변경 오류:",e),i.NextResponse.json({error:"비밀번호 변경 중 오류가 발생했습니다"},{status:500})}}let x=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/auth/password/route",pathname:"/api/auth/password",filename:"route",bundlePath:"app/api/auth/password/route"},resolvedPagePath:"/Users/jelly/WebstormProjects/chocoya-coffee/app/webserver/src/app/api/auth/password/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:w,workUnitAsyncStorage:f,serverHooks:m}=x;function h(){return(0,a.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:f})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[191,3395,5208,3744,1610],()=>t(99044));module.exports=s})();