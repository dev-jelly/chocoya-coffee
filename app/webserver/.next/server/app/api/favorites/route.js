(()=>{var e={};e.id=8945,e.ids=[8945],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},19289:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>x,routeModule:()=>l,serverHooks:()=>f,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>v});var n={};t.r(n),t.d(n,{POST:()=>p});var s=t(48106),o=t(48819),i=t(12050),c=t(4235),a=t(44627),u=t(84875);async function p(e){try{let r;let t=await (0,u.U)(),{data:{user:n}}=await t.auth.getUser();if(!n?.email)return c.NextResponse.json({error:"인증이 필요합니다."},{status:401});let s=await a.zR.user.findUnique({where:{email:n.email}});if(!s)return c.NextResponse.json({error:"사용자를 찾을 수 없습니다."},{status:404});let{recipeId:o}=await e.json();if(!o)return c.NextResponse.json({error:"레시피 ID가 필요합니다."},{status:400});if(!await a.zR.recipe.findUnique({where:{id:o}}))return c.NextResponse.json({error:"레시피를 찾을 수 없습니다."},{status:404});return await a.zR.favorite.findUnique({where:{recipeId_userId:{recipeId:o,userId:s.id}}})?(await a.zR.favorite.delete({where:{recipeId_userId:{recipeId:o,userId:s.id}}}),r=!1):(await a.zR.favorite.create({data:{recipeId:o,userId:s.id}}),r=!0),c.NextResponse.json({success:!0,isFavorite:r})}catch(e){return console.error("즐겨찾기 처리 중 오류:",e),c.NextResponse.json({error:"즐겨찾기 처리 중 오류가 발생했습니다."},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/favorites/route",pathname:"/api/favorites",filename:"route",bundlePath:"app/api/favorites/route"},resolvedPagePath:"/Users/jelly/WebstormProjects/chocoya-coffee/app/webserver/src/app/api/favorites/route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:d,workUnitAsyncStorage:v,serverHooks:f}=l;function x(){return(0,i.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:v})}},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},44627:(e,r,t)=>{"use strict";t.d(r,{kR:()=>c,zR:()=>o});var n=t(96330);let s=global;s.isConnected||(s.isConnected=!1,s.connectionError=null,s.lastConnectionAttempt=0,s.connectionRetryCount=0);let o=s.prisma??function(){let e=process.env.DATABASE_URL;process.env.DIRECT_URL;let r={log:["error"],errorFormat:"pretty"};return e&&(r.datasources={db:{url:e}}),new n.PrismaClient(r)}();async function i(){try{let e=Date.now();if(s.isConnected)return{connected:!0,error:null};if(s.connectionError&&e-s.lastConnectionAttempt<3e4)return{connected:!1,error:s.connectionError};if(s.connectionRetryCount>=3){let r=e-s.lastConnectionAttempt;if(r<3e4)return{connected:!1,error:`${s.connectionError} (${Math.ceil((3e4-r)/1e3)}초 후 재시도 가능)`};s.connectionRetryCount=0}return s.lastConnectionAttempt=e,s.connectionRetryCount++,await o.user.findFirst({select:{id:!0},take:1}),s.isConnected=!0,s.connectionError=null,s.connectionRetryCount=0,{connected:!0,error:null}}catch(r){console.error("Database connection error:",r);let e="데이터베이스 연결 오류";return r instanceof Error&&(r.message.includes("P5010")||r.message.includes("fetch failed")?e="데이터베이스 서버에 연결할 수 없습니다. 네트워크 연결을 확인하거나 잠시 후 다시 시도해주세요.":r.message.includes("timeout")?e="데이터베이스 연결 시간이 초과되었습니다. 잠시 후 다시 시도해주세요.":r.message.includes("authentication")&&(e="데이터베이스 인증에 실패했습니다. 관리자에게 문의하세요.")),s.isConnected=!1,s.connectionError=e,{connected:!1,error:e}}}async function c(e,r,t){try{let n=await i();if(!n.connected)return t&&t(Error(n.error||"데이터베이스 연결 오류")),r;return await e()}catch(e){return console.error("Database operation error:",e),t&&t(e),r}}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},80408:()=>{},81630:e=>{"use strict";e.exports=require("http")},84875:(e,r,t)=>{"use strict";t.d(r,{U:()=>o});var n=t(65208),s=t(83395);async function o(){try{let e;try{e=await (0,n.UL)()}catch(e){return console.warn("정적 렌더링 중 cookies() 호출 실패:",e),(0,s.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL||"",process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",{cookies:{get:e=>"",set(e,r,t){},remove(e,r){}}})}return(0,s.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL||"",process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",{cookies:{async get(r){let t=await e.get(r);return t?.value},set(r,t,n){try{e.set({name:r,value:t,...n})}catch(e){console.warn("Warning: Failed to set cookie in a Server Component.",e)}},remove(r,t){try{e.delete({name:r,...t})}catch(e){console.warn("Warning: Failed to remove cookie in a Server Component.",e)}}}})}catch(e){return console.error("Supabase 클라이언트 생성 오류:",e),(0,s.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL||"",process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",{cookies:{get:e=>"",set(e,r,t){},remove(e,r){}}})}}},87032:()=>{},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96330:e=>{"use strict";e.exports=require("@prisma/client")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[191,3395,5208,3744],()=>t(19289));module.exports=n})();