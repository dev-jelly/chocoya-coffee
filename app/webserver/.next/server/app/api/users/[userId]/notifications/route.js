(()=>{var e={};e.id=4122,e.ids=[4122],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},38186:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>f,serverHooks:()=>m,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>N});var i={};r.r(i),r.d(i,{GET:()=>p,POST:()=>l});var o=r(48106),n=r(48819),s=r(12050),c=r(4235),a=r(44627),u=r(84875);async function p(e,t){try{let e=await (0,u.U)(),{data:{user:r}}=await e.auth.getUser();if(!r?.id)return c.NextResponse.json({error:"인증이 필요합니다"},{status:401});let i=t.params.userId;if(r.id!==i)return c.NextResponse.json({error:"권한이 없습니다"},{status:403});let o=await a.zR.notificationSettings.findUnique({where:{userId:i}});if(!o)return c.NextResponse.json({preferences:{emailNotifications:!0,newRecipeNotifications:!0,marketingNotifications:!1,securityNotifications:!0}});return c.NextResponse.json({preferences:{emailNotifications:o.emailNotifications,newRecipeNotifications:o.newRecipeNotifications,marketingNotifications:o.marketingNotifications,securityNotifications:o.securityNotifications}})}catch(e){return console.error("알림 설정 조회 오류:",e),c.NextResponse.json({error:"알림 설정 조회 중 오류가 발생했습니다"},{status:500})}}async function l(e,t){try{let r=await (0,u.U)(),{data:{user:i}}=await r.auth.getUser();if(!i?.id)return c.NextResponse.json({error:"인증이 필요합니다"},{status:401});let o=t.params.userId;if(i.id!==o)return c.NextResponse.json({error:"권한이 없습니다"},{status:403});let{preferences:n}=await e.json();if(!n)return c.NextResponse.json({error:"알림 설정 정보가 필요합니다"},{status:400});let s=await a.zR.notificationSettings.upsert({where:{userId:o},update:{emailNotifications:n.emailNotifications??!0,newRecipeNotifications:n.newRecipeNotifications??!0,marketingNotifications:n.marketingNotifications??!1,securityNotifications:n.securityNotifications??!0},create:{userId:o,emailNotifications:n.emailNotifications??!0,newRecipeNotifications:n.newRecipeNotifications??!0,marketingNotifications:n.marketingNotifications??!1,securityNotifications:n.securityNotifications??!0}});return c.NextResponse.json({message:"알림 설정이 성공적으로 업데이트되었습니다",preferences:{emailNotifications:s.emailNotifications,newRecipeNotifications:s.newRecipeNotifications,marketingNotifications:s.marketingNotifications,securityNotifications:s.securityNotifications}})}catch(e){return console.error("알림 설정 업데이트 오류:",e),c.NextResponse.json({error:"알림 설정 업데이트 중 오류가 발생했습니다"},{status:500})}}let f=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/users/[userId]/notifications/route",pathname:"/api/users/[userId]/notifications",filename:"route",bundlePath:"app/api/users/[userId]/notifications/route"},resolvedPagePath:"/Users/jelly/WebstormProjects/chocoya-coffee/app/webserver/src/app/api/users/[userId]/notifications/route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:d,workUnitAsyncStorage:N,serverHooks:m}=f;function x(){return(0,s.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:N})}},44627:(e,t,r)=>{"use strict";r.d(t,{kR:()=>c,zR:()=>n});var i=r(96330);let o=global;o.isConnected||(o.isConnected=!1,o.connectionError=null,o.lastConnectionAttempt=0,o.connectionRetryCount=0);let n=o.prisma??function(){let e=process.env.DATABASE_URL;process.env.DIRECT_URL;let t={log:["error"],errorFormat:"pretty"};return e&&(t.datasources={db:{url:e}}),new i.PrismaClient(t)}();async function s(){try{let e=Date.now();if(o.isConnected)return{connected:!0,error:null};if(o.connectionError&&e-o.lastConnectionAttempt<3e4)return{connected:!1,error:o.connectionError};if(o.connectionRetryCount>=3){let t=e-o.lastConnectionAttempt;if(t<3e4)return{connected:!1,error:`${o.connectionError} (${Math.ceil((3e4-t)/1e3)}초 후 재시도 가능)`};o.connectionRetryCount=0}return o.lastConnectionAttempt=e,o.connectionRetryCount++,await n.user.findFirst({select:{id:!0},take:1}),o.isConnected=!0,o.connectionError=null,o.connectionRetryCount=0,{connected:!0,error:null}}catch(t){console.error("Database connection error:",t);let e="데이터베이스 연결 오류";return t instanceof Error&&(t.message.includes("P5010")||t.message.includes("fetch failed")?e="데이터베이스 서버에 연결할 수 없습니다. 네트워크 연결을 확인하거나 잠시 후 다시 시도해주세요.":t.message.includes("timeout")?e="데이터베이스 연결 시간이 초과되었습니다. 잠시 후 다시 시도해주세요.":t.message.includes("authentication")&&(e="데이터베이스 인증에 실패했습니다. 관리자에게 문의하세요.")),o.isConnected=!1,o.connectionError=e,{connected:!1,error:e}}}async function c(e,t,r){try{let i=await s();if(!i.connected)return r&&r(Error(i.error||"데이터베이스 연결 오류")),t;return await e()}catch(e){return console.error("Database operation error:",e),r&&r(e),t}}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},80408:()=>{},81630:e=>{"use strict";e.exports=require("http")},84875:(e,t,r)=>{"use strict";r.d(t,{U:()=>n});var i=r(65208),o=r(83395);async function n(){try{let e;try{e=await (0,i.UL)()}catch(e){return console.warn("정적 렌더링 중 cookies() 호출 실패:",e),(0,o.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL||"",process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",{cookies:{get:e=>"",set(e,t,r){},remove(e,t){}}})}return(0,o.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL||"",process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",{cookies:{async get(t){let r=await e.get(t);return r?.value},set(t,r,i){try{e.set({name:t,value:r,...i})}catch(e){console.warn("Warning: Failed to set cookie in a Server Component.",e)}},remove(t,r){try{e.delete({name:t,...r})}catch(e){console.warn("Warning: Failed to remove cookie in a Server Component.",e)}}}})}catch(e){return console.error("Supabase 클라이언트 생성 오류:",e),(0,o.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL||"",process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",{cookies:{get:e=>"",set(e,t,r){},remove(e,t){}}})}}},87032:()=>{},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96330:e=>{"use strict";e.exports=require("@prisma/client")}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[191,3395,5208,3744],()=>r(38186));module.exports=i})();