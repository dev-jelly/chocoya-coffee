(()=>{var e={};e.id=318,e.ids=[318],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},38705:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>C,routeModule:()=>f,serverHooks:()=>y,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>R});var s={};t.r(s),t.d(s,{POST:()=>x});var n=t(48106),o=t(48819),i=t(12050),c=t(4235),u=t(44627),a=t(83395);let p=process.env.NEXT_PUBLIC_SUPABASE_URL||"",l=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"";if(!p||!l)throw Error("Supabase URL과 익명 키가 설정되지 않았습니다.");let d=(0,a.createBrowserClient)(p,l);async function x(e){try{let{id:r,name:t,email:s}=await e.json(),{data:n}=await d.auth.getUser(),o=n.user,i=!1;if(o&&o.id===r?i=!0:r&&t&&s&&(i=!0,console.log("인증되지 않은 상태에서 사용자 생성 요청. 필수 정보 확인 후 허용")),!i)return c.NextResponse.json({error:"인증되지 않은 요청입니다."},{status:401});if(await u.zR.user.findUnique({where:{id:r}}))return c.NextResponse.json({error:"이미 등록된 사용자입니다."},{status:409});let a=await u.zR.user.create({data:{id:r,name:t,email:s,emailVerified:new Date}});return c.NextResponse.json({success:!0,user:a},{status:201})}catch(e){if(console.error("사용자 생성 오류:",e),e instanceof Error&&e.message.includes("Unique constraint failed"))return c.NextResponse.json({error:"이미 등록된 사용자입니다."},{status:409});return c.NextResponse.json({error:"사용자 생성 중 오류가 발생했습니다."},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/users/route",pathname:"/api/users",filename:"route",bundlePath:"app/api/users/route"},resolvedPagePath:"/Users/jelly/WebstormProjects/chocoya-coffee/app/webserver/src/app/api/users/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:R,serverHooks:y}=f;function C(){return(0,i.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:R})}},44627:(e,r,t)=>{"use strict";t.d(r,{kR:()=>c,zR:()=>o});var s=t(96330);let n=global;n.isConnected||(n.isConnected=!1,n.connectionError=null,n.lastConnectionAttempt=0,n.connectionRetryCount=0);let o=n.prisma??function(){let e=process.env.DATABASE_URL;process.env.DIRECT_URL;let r={log:["error"],errorFormat:"pretty"};return e&&(r.datasources={db:{url:e}}),new s.PrismaClient(r)}();async function i(){try{let e=Date.now();if(n.isConnected)return{connected:!0,error:null};if(n.connectionError&&e-n.lastConnectionAttempt<3e4)return{connected:!1,error:n.connectionError};if(n.connectionRetryCount>=3){let r=e-n.lastConnectionAttempt;if(r<3e4)return{connected:!1,error:`${n.connectionError} (${Math.ceil((3e4-r)/1e3)}초 후 재시도 가능)`};n.connectionRetryCount=0}return n.lastConnectionAttempt=e,n.connectionRetryCount++,await o.user.findFirst({select:{id:!0},take:1}),n.isConnected=!0,n.connectionError=null,n.connectionRetryCount=0,{connected:!0,error:null}}catch(r){console.error("Database connection error:",r);let e="데이터베이스 연결 오류";return r instanceof Error&&(r.message.includes("P5010")||r.message.includes("fetch failed")?e="데이터베이스 서버에 연결할 수 없습니다. 네트워크 연결을 확인하거나 잠시 후 다시 시도해주세요.":r.message.includes("timeout")?e="데이터베이스 연결 시간이 초과되었습니다. 잠시 후 다시 시도해주세요.":r.message.includes("authentication")&&(e="데이터베이스 인증에 실패했습니다. 관리자에게 문의하세요.")),n.isConnected=!1,n.connectionError=e,{connected:!1,error:e}}}async function c(e,r,t){try{let s=await i();if(!s.connected)return t&&t(Error(s.error||"데이터베이스 연결 오류")),r;return await e()}catch(e){return console.error("Database operation error:",e),t&&t(e),r}}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},80408:()=>{},81630:e=>{"use strict";e.exports=require("http")},87032:()=>{},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96330:e=>{"use strict";e.exports=require("@prisma/client")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[191,3395,3744],()=>t(38705));module.exports=s})();